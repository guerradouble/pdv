# PDV - Sistema de Ponto de Venda

Sistema completo de gerenciamento para restaurantes com funcionalidades de cadastro de cardápio, pedidos de balcão e delivery.

## Funcionalidades

- **Cadastro de Cardápio**: Gerencie produtos, tipos, preços e ingredientes
- **Pedidos de Balcão**: Sistema de pedidos para atendimento presencial
- **Delivery**: Gestão de pedidos para entrega
- **Exportação**: Exporte dados em PDF e CSV

## Configuração do Supabase

### Variáveis de Ambiente

Adicione as seguintes variáveis de ambiente no seu projeto Vercel:

\`\`\`env
NEXT_PUBLIC_SUPABASE_URL=sua_url_do_supabase
NEXT_PUBLIC_SUPABASE_ANON_KEY=sua_chave_anonima_do_supabase
\`\`\`

### Estrutura do Banco de Dados

O sistema requer as seguintes tabelas no Supabase:

#### 1. ENUM tipo_produto

\`\`\`sql
CREATE TYPE public.tipo_produto AS ENUM (
    'Hambúrguer',
    'Bebida',
    'Molho'
);
\`\`\`

**IMPORTANTE**: Os valores do ENUM devem corresponder exatamente aos tipos usados no sistema. Se você adicionar novos tipos através da interface, certifique-se de adicioná-los ao ENUM no Supabase:

\`\`\`sql
ALTER TYPE public.tipo_produto ADD VALUE 'NovoTipo';
\`\`\`

#### 2. Tabela cadastro_cardapio

\`\`\`sql
CREATE TABLE public.cadastro_cardapio (
  id UUID NOT NULL DEFAULT gen_random_uuid(),
  nome VARCHAR(255) NOT NULL,
  tipo public.tipo_produto NOT NULL,
  preco NUMERIC(10, 2) NOT NULL,
  ingredientes TEXT NULL,
  created_at TIMESTAMP WITH TIME ZONE NOT NULL DEFAULT timezone('utc'::text, now()),
  CONSTRAINT cadastro_cardapio_pkey PRIMARY KEY (id),
  CONSTRAINT cadastro_cardapio_preco_check CHECK (preco >= 0)
);

CREATE INDEX idx_cadastro_cardapio_tipo ON public.cadastro_cardapio(tipo);
CREATE INDEX idx_cadastro_cardapio_created_at ON public.cadastro_cardapio(created_at DESC);
\`\`\`

#### 3. Tabela tipos_produtos (Opcional)

\`\`\`sql
CREATE TABLE public.tipos_produtos (
  id BIGINT GENERATED BY DEFAULT AS IDENTITY NOT NULL,
  nome TEXT NOT NULL,
  ordem INTEGER NULL DEFAULT 0,
  created_at TIMESTAMP WITH TIME ZONE NOT NULL DEFAULT timezone('utc'::text, now()),
  updated_at TIMESTAMP WITH TIME ZONE NOT NULL DEFAULT timezone('utc'::text, now()),
  CONSTRAINT tipos_produtos_pkey PRIMARY KEY (id),
  CONSTRAINT tipos_produtos_nome_key UNIQUE (nome)
);
\`\`\`

#### 4. Tabela pedidos_balcao

\`\`\`sql
CREATE TABLE public.pedidos_balcao (
  id UUID NOT NULL DEFAULT gen_random_uuid(),
  nome_cliente TEXT NOT NULL,
  telefone TEXT NULL,
  mesa TEXT NULL,
  status TEXT NOT NULL DEFAULT 'pendente',
  total NUMERIC(10, 2) NOT NULL DEFAULT 0,
  created_at TIMESTAMP WITH TIME ZONE NULL DEFAULT now(),
  updated_at TIMESTAMP WITH TIME ZONE NULL DEFAULT now(),
  tipo TEXT NOT NULL DEFAULT 'balcao',
  CONSTRAINT pedidos_balcao_pkey PRIMARY KEY (id),
  CONSTRAINT pedidos_balcao_status_check CHECK (
    status = ANY (ARRAY['pendente', 'pronto', 'cancelado'])
  ),
  CONSTRAINT pedidos_balcao_tipo_check CHECK (
    tipo = ANY (ARRAY['balcao', 'delivery'])
  )
);
\`\`\`

#### 5. Tabela pedidos_balcao_itens

\`\`\`sql
CREATE TABLE public.pedidos_balcao_itens (
  id UUID NOT NULL DEFAULT gen_random_uuid(),
  pedido_id UUID NOT NULL,
  produto_id UUID NOT NULL,
  produto_nome TEXT NOT NULL,
  produto_preco NUMERIC(10, 2) NOT NULL,
  quantidade INTEGER NOT NULL,
  subtotal NUMERIC(10, 2) NOT NULL,
  created_at TIMESTAMP WITH TIME ZONE NULL DEFAULT now(),
  CONSTRAINT pedidos_balcao_itens_pkey PRIMARY KEY (id),
  CONSTRAINT pedidos_balcao_itens_pedido_id_fkey FOREIGN KEY (pedido_id) 
    REFERENCES pedidos_balcao (id) ON DELETE CASCADE,
  CONSTRAINT pedidos_balcao_itens_produto_id_fkey FOREIGN KEY (produto_id) 
    REFERENCES cadastro_cardapio (id) ON DELETE RESTRICT,
  CONSTRAINT pedidos_balcao_itens_quantidade_check CHECK (quantidade > 0)
);
\`\`\`

### Row Level Security (RLS)

Habilite RLS e crie políticas para permitir acesso público (ajuste conforme suas necessidades de segurança):

\`\`\`sql
-- Para cadastro_cardapio
ALTER TABLE public.cadastro_cardapio ENABLE ROW LEVEL SECURITY;

CREATE POLICY "Allow public read access" ON public.cadastro_cardapio
  FOR SELECT USING (true);

CREATE POLICY "Allow public insert access" ON public.cadastro_cardapio
  FOR INSERT WITH CHECK (true);

CREATE POLICY "Allow public update access" ON public.cadastro_cardapio
  FOR UPDATE USING (true) WITH CHECK (true);

CREATE POLICY "Allow public delete access" ON public.cadastro_cardapio
  FOR DELETE USING (true);
\`\`\`

## Solução de Problemas

### Erro 400 ao inserir produtos

Se você receber um erro 400 ao tentar adicionar produtos, verifique:

1. **ENUM tipo_produto**: Certifique-se de que o ENUM existe e contém os valores corretos
2. **Valores do tipo**: Os valores selecionados no formulário devem corresponder EXATAMENTE aos valores do ENUM (case-sensitive)
3. **Campos obrigatórios**: Todos os campos marcados como NOT NULL devem ser preenchidos

Para verificar os valores do ENUM no Supabase:

\`\`\`sql
SELECT unnest(enum_range(NULL::public.tipo_produto));
\`\`\`

### Erro de conexão com Supabase

Verifique se as variáveis de ambiente estão configuradas corretamente no Vercel.

## Desenvolvimento

\`\`\`bash
npm install
npm run dev
\`\`\`

Acesse [http://localhost:3000](http://localhost:3000)

## Deploy

O projeto está configurado para deploy automático no Vercel. Certifique-se de adicionar as variáveis de ambiente antes do deploy.
